# Vue Frontend Design — PRAG-v2

**Date:** 2026-02-27
**Status:** Approved
**Replaces:** Streamlit frontend (`frontend/`)

---

## Context

PRAG-v2 is a local academic RAG system with a FastAPI backend and Qdrant vector DB running
via Docker Compose. The existing Streamlit frontend requires a Python server and cannot be
deployed to GitHub Pages. This document describes the replacement: a static Vue 3 frontend
deployed to GitHub Pages that talks directly to the user's local Docker backend.

---

## Goals

- Deploy a lightweight static frontend to GitHub Pages
- Keep the backend (FastAPI + Qdrant + Ollama) entirely local via Docker Compose
- Mirror the existing 5-tab Streamlit UI, improving where straightforward
- Keep the frontend code clean and easy to extend

---

## Branch Strategy

| Branch | Purpose |
|---|---|
| `streamlit` | Preserves the Streamlit frontend exactly as-is |
| `main` | Vue frontend + backend (source of truth going forward) |
| `gh-pages` | Auto-generated by GitHub Actions; serves the static site |

---

## File Structure

```
PRAG-v2/
├── backend/                    # FastAPI app (unchanged)
├── frontend-web/               # NEW: Vue static frontend
│   ├── index.html              # Entire app (Vue CDN + CSS + JS)
│   └── .nojekyll               # Prevents GitHub Pages from running Jekyll
├── .github/
│   └── workflows/
│       └── deploy.yml          # GitHub Actions: push frontend-web/ → gh-pages
├── docker-compose.yml          # Removes frontend service, backend+qdrant unchanged
└── docs/plans/
    └── 2026-02-27-vue-frontend-design.md
```

The old `frontend/` (Streamlit) directory is deleted from `main`.

---

## Architecture

### Frontend

**Technology:** Vue 3 via CDN (`https://unpkg.com/vue@3/dist/vue.esm-browser.js`)
**Deployment:** Single `index.html` — no build step, no npm
**Hosting:** GitHub Pages serving from the `gh-pages` branch

The app is a single-page application with:
- A fixed left sidebar (~260px) for navigation, connection status, and settings
- A tabbed content area on the right

As complexity grows, components can be extracted into separate `.js` files loaded as ES modules.

### Backend

No changes to the FastAPI backend. The only modifications are:
1. Restrict CORS `allow_origins` to include the GitHub Pages URL
2. Remove the `frontend` service from `docker-compose.yml`

### Communication

The frontend makes direct `fetch()` calls to the local backend URL stored in `localStorage`.
There is no proxy, no server-side rendering, no build-time API calls.

---

## UI Layout

```
┌─────────────────────────────────────────────────────┐
│  PRAG-v2                              ⚙ Settings    │
├──────────────┬──────────────────────────────────────┤
│              │  [PDF Mgmt] [Collections] [RAG]       │
│  Connection  │  [Explore] [Compare]                  │
│  ✅ Backend  │                                       │
│  ✅ Qdrant   │  ┌─── Tab content area ────────────┐ │
│  ✅ Ollama   │  │                                  │ │
│              │  │  (per-tab UI here)               │ │
│  Collection: │  │                                  │ │
│  [picker ▾] │  └──────────────────────────────────┘ │
│              │                                       │
│  ─────────   │  [error banner if API fails]          │
│  (future     │                                       │
│   nav items) │                                       │
└──────────────┴──────────────────────────────────────┘
```

---

## Tabs

### 1. PDF Management
- Upload PDF files (multipart POST to `/preprocess/upload`)
- List PDF directories and files
- Trigger conversion (POST to `/preprocess/convert`)
- Show conversion status with inline spinner
- Delete PDFs

### 2. Collections
- List existing collections
- Create new collection with collection ID + search type (dense/hybrid)
- Scan preprocessed directory and ingest files
- Delete collections

### 3. RAG Query
- Select collection (or use sidebar picker)
- Text input for query
- Options: limit, max tokens, hybrid toggle, include citations
- Display: generated answer + retrieved passages (collapsible) + citations (APA/BibTeX toggle)

### 4. Explore Paper
- Select collection → browse papers
- View paper metadata, abstract, chunk count
- Download markdown

### 5. Compare
- Select collection + multiple papers
- Select comparison aspect
- Display comparison result

---

## Sidebar — Settings Modal

A gear icon opens a modal:
```
Backend URL: [ http://localhost:8000      ]
Status:      ✅ Connected (checks GET /health)

[ Save & Close ]
```

URL is saved to `localStorage` key `prag_backend_url`.
Connection status is checked on save and every 30 seconds passively.

---

## Data Flow

```
Vue component
    │
    ├── api.get('/collections')
    ├── api.post('/collections/x/rag', body)
    └── api.upload('/preprocess/upload', formData)
         │
         │  fetch(localStorage backendUrl + path)
         ▼
    FastAPI backend (http://localhost:8000)
         │
         ├── Qdrant (http://qdrant:6333)
         └── Ollama (http://host.docker.internal:11434)
```

### Shared State

Managed in the root Vue `app.data()`:
- `backendUrl` — read from localStorage on mount
- `selectedCollection` — persisted to localStorage
- `health` — polled every 30s

Components receive `backendUrl` and `selectedCollection` as props, emit events to update them.

### API Wrapper

```js
const api = {
  baseUrl: () => localStorage.getItem('prag_backend_url') || 'http://localhost:8000',
  async get(path) {
    const r = await fetch(api.baseUrl() + path)
    if (!r.ok) throw new Error(await r.text())
    return r.json()
  },
  async post(path, body) {
    const r = await fetch(api.baseUrl() + path, {
      method: 'POST', headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(body)
    })
    if (!r.ok) throw new Error(await r.text())
    return r.json()
  },
  async upload(path, formData) {
    const r = await fetch(api.baseUrl() + path, { method: 'POST', body: formData })
    if (!r.ok) throw new Error(await r.text())
    return r.json()
  }
}
```

### Error Handling

Every component has `error: null` in its local state. Errors from `api.*` are caught and set there. A dismissible red banner renders at the top of the tab content when `error !== null`.

### Loading States

Every async operation sets a local `loading: true` flag. Buttons disable and show a spinner during requests. Tabs do not block each other.

---

## GitHub Actions Deployment

**Trigger:** Push to `main` (any file changed)
**Steps:**
1. Checkout `main`
2. Copy `frontend-web/` contents to the `gh-pages` branch
3. Push `gh-pages`

GitHub Pages is configured to serve from the `gh-pages` branch root.

---

## CORS Update

```python
# backend/app/main.py
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:*",
        "https://<username>.github.io",
    ],
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## Improvements Over Streamlit

| Streamlit behaviour | Vue improvement |
|---|---|
| Sidebar scrolls with page | Sidebar is sticky/fixed |
| Full page rerender on tab switch | Instant client-side tab switch |
| File upload blocks UI | Inline progress, UI stays responsive |
| Citations shown as a flat wall of text | Collapsible per-result citation panel |
| Settings require page reload | Settings saved instantly, connection rechecked live |

---

## Out of Scope (for now)

- Authentication / access control on GitHub Pages
- Dark mode
- Responsive mobile layout
- Splitting index.html into multiple component files
- Streaming LLM responses (SSE)
